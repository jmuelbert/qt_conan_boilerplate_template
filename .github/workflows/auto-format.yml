name: format
on:
  push:
  pull_request:

jobs:
  format:
    name: "ðŸ’Ž Format"
    runs-on: ubuntu-latest

    steps:
      - name: "ðŸ§° Checkout"
        uses: actions/checkout@v2.3.4

      - name: "ðŸŸ¨ Use clang-format"
        uses: DoozyX/clang-format-lint-action@v0.13
        with:
          source: "."
          exclude: "./third_party ./external"
          extensions: "h,cpp,hpp"
          clangFormatVersion: 12
          inplace: True

      - name: "ðŸŸ¨ Setup Python"
        uses: actions/setup-python@v2

      - name: "ðŸŸ¨ Install cmakelang"
        uses: BSFishy/pip-action@v1
        with:
          packages: cmakelang pyyaml jinja2

      - name: "ðŸŸ¨ Use cmake-format"
        run: find . \( -name '*.cmake' -o -name 'CMakeLists.txt' \) -exec cmake-format -i {} \;

      - name: "ðŸ“¨ Use Commit"
        uses: EndBug/add-and-commit@v4
        with:
          author_name: github_actions
          message: ":art: Committing format changes"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
